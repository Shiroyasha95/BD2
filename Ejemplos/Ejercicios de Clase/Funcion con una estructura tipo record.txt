CREATE OR REPLACE FUNCTION FN_INF_ORDER_CLIENTE
-- DEBE REGRESAR UN CURSOR
RETURN SYS_REFCURSOR
IS
   CDATOS SYS_REFCURSOR;
   
BEGIN
--ABRIR EL CURSOR
   OPEN CDATOS FOR SELECT ORDERS.ORDER_ID,TO_TIMESTAMP(ORDERS.ORDER_DATE,'YYYYMMDD'),TO_TIMESTAMP(ORDERS.SHIPPED_DATE,'YYYYMMDD'),CUSTOMERS.CUSTOMER_ID,CUSTOMERS.FIRST_NAME,
   CUSTOMERS.LAST_NAME
   FROM ORDERS INNER JOIN CUSTOMERS ON ORDERS.CUSTOMER_ID=CUSTOMERS.CUSTOMER_ID;
   RETURN CDATOS;
END;

DECLARE
   DATOS_CAT SYS_REFCURSOR;
   
   TYPE FILA IS RECORD(
   ORDER_ID ORDERS.ORDER_ID%TYPE,
   ORDER_DATE TIMESTAMP,
   SHIPPED_DATE TIMESTAMP,
   CUSTOMER_ID CUSTOMERS.CUSTOMER_ID%TYPE,
   FIRST_NAME CUSTOMERS.FIRST_NAME%TYPE,
   LAST_NAME CUSTOMERS.LAST_NAME%TYPE   
   );
   
   REGISTRO FILA;
   
BEGIN
    DATOS_CAT:=FN_INF_ORDER_CLIENTE;
    -- RECORRER CON UN CICLO
    LOOP
    --CUIDADO CON EL ORDEN 
      FETCH DATOS_CAT INTO REGISTRO;
      --SALIR CUANDO NO ENCUENTRE NADA
      EXIT WHEN DATOS_CAT%NOTFOUND;
      DBMS_OUTPUT.PUT_LINE('EL ID DE ORDEN ES: '||REGISTRO.ORDER_ID);
      DBMS_OUTPUT.PUT_LINE('LA FECHA DE LA ORDEN: '||REGISTRO.ORDER_DATE);
      DBMS_OUTPUT.PUT_LINE('LA FECHA DE ENVIO DE LA ORDEN: '||REGISTRO.SHIPPED_DATE);
      DBMS_OUTPUT.PUT_LINE('ID DEL CLIENTE: '||REGISTRO.CUSTOMER_ID);
      DBMS_OUTPUT.PUT_LINE('NOMBRE DEL CLIENTE: '||REGISTRO.FIRST_NAME);
      DBMS_OUTPUT.PUT_LINE('APELLIDO DEL CLIENTE: '||REGISTRO.LAST_NAME);
      DBMS_OUTPUT.PUT_LINE(CHR(13));  
    END LOOP;
END;


--ES RECOMENDABLE QUE LAS FUNCIONES NO IMPRIMAN VALORES DENTRO DE SU CUERPO